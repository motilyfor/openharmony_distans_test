"use strict";var __awaiter=this&&this.__awaiter||function(e,r,t,o){return new(t||(t=Promise))((function(i,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function _(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var r;e.done?i(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(a,_)}l((o=o.apply(e,r||[])).next())}))},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.run=exports.hvigorPath=void 0;const process_1=__importDefault(require("process")),exit_1=require("../exit"),make_title_1=require("../make-title"),cli_options_1=require("../options/cli-options"),process_utils_1=require("../process-utils"),init_env_config_props_1=require("../init-env-config-props"),hvigor_base_1=require("@ohos/hvigor-base"),pretty_hrtime_1=__importDefault(require("pretty-hrtime")),profile_js_1=require("../lifecycle/profile.js"),process_cli_argv_js_1=require("../lifecycle/process-cli-argv.js"),fs_extra_1=__importDefault(require("fs-extra")),LiftOff=require("liftoff"),v8flags=require("v8flags"),yargs=require("yargs"),interpret=require("interpret");exports.hvigorPath=require.resolve("@ohos/hvigor-base",{paths:[process_1.default.cwd()]});const hvigor_base_2=require("@ohos/hvigor-base"),path_1=__importDefault(require("path")),replacer_1=require("./replacer"),_log=hvigor_base_1.HvigorLogger.getLogger("hvigor"),LOWEST_NODE_VERSION="v14.18.3",cli=new LiftOff({name:"hvigor",processTitle:(0,make_title_1.makeTitle)("hvigor",process_1.default.argv.slice(2)),moduleName:exports.hvigorPath,configName:"hvigorFile",v8flags:v8flags,extensions:interpret.jsVariants}),parser=yargs.usage("Usage",cli_options_1.cliOptions),opts=parser.argv;function run(){cli.prepare({cwd:opts.cwd,require:opts.require,completion:opts.completion},(function(e){(0,process_cli_argv_js_1.processArgvBeforeConfiguration)(opts,e.modulePackage.version),process_1.default.version<"v14.18.3"&&(_log.warn(`node version: ${process_1.default.version}`),_log.warn("node version cannot be lower than v14.18.3"),(0,exit_1.exit)(-1)),evaluateLogLevel(),(0,init_env_config_props_1.initEnvConfigProps)(e,opts),cli.execute(e,e.nodeFlags,(function(){return __awaiter(this,void 0,void 0,(function*(){const r=process_1.default.hrtime();yield(0,process_utils_1.processUtils)(opts,e);const t=process_1.default.hrtime(r),o=(0,pretty_hrtime_1.default)(t);0===profile_js_1.profile.executed&&_log.error("No task found to execute in project!"),_log.info(`BUILD SUCCESSFUL in ${o}`),traceEnd(e.cwd,1e9*t[0]+t[1])}))}))}))}function evaluateLogLevel(){opts.debug?_log.setLevel(hvigor_base_1.levels.DEBUG):opts.warn?_log.setLevel(hvigor_base_1.levels.WARN):opts.error?_log.setLevel(hvigor_base_1.levels.ERROR):_log.setLevel(hvigor_base_1.levels.INFO)}function traceEnd(e,r){hvigor_base_2.traceBuildAnalyze.totalTime=r;const t=".hvigor/outputs/logs/details";fs_extra_1.default.existsSync(path_1.default.resolve(e,t))||fs_extra_1.default.mkdirSync(path_1.default.resolve(e,t),{recursive:!0});try{fs_extra_1.default.writeFileSync(path_1.default.resolve(e,t,"details.json"),JSON.stringify(hvigor_base_2.traceBuildAnalyze,replacer_1.replacer,2))}catch(e){}}exports.run=run;