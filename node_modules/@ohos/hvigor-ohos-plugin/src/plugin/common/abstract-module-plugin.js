"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbstractModulePlugin=void 0;const module_task_service_js_1=require("../../tasks/service/module-task-service.js"),legacy_project_model_impl_js_1=require("../../model/project/legacy-project-model-impl.js"),project_model_impl_js_1=require("../../model/project/project-model-impl.js"),hvigor_base_1=require("@ohos/hvigor-base"),hap_extra_info_js_1=require("../../project/data/hap-extra-info.js"),ohos_logger_js_1=require("../../utils/log/ohos-logger.js"),dependency_manager_js_1=require("../../project/dependency/dependency-manager.js"),clean_js_1=require("../../tasks/common/clean.js"),compile_native_hook_js_1=require("../../tasks/common/compile-native-hook.js");class AbstractModulePlugin extends hvigor_base_1.HvigorPlugin{constructor(e,o,t,s){super(e),this._log=ohos_logger_js_1.OhosLogger.getLogger(AbstractModulePlugin.name),this._module=o;const i=o.getProject();this.isFaMode=t,this.isHap=s,this._projectModel=this.isFaMode?legacy_project_model_impl_js_1.LegacyProjectModelImpl.getInstance(i):project_model_impl_js_1.ProjectModelImpl.getInstance(i),this._moduleModel=this._projectModel.getModuleModelByName(this._module.getName()),this.checkModuleStatus(t?hap_extra_info_js_1.ApiType.FA:hap_extra_info_js_1.ApiType.STAGE);const r=new dependency_manager_js_1.DependencyManager(t,this._moduleModel,this._projectModel);this._taskService=new module_task_service_js_1.ModuleTaskService(this._module,this._projectModel,this._moduleModel,r.createModelDependencyInfo()),this.initCommonTasks(),this.initTasks()}initCommonTasks(){this.clean=new clean_js_1.Clean(this._module,this._taskService),this.compileNative=new compile_native_hook_js_1.CompileNativeHook(this._taskService),this._module.registry(this.clean),this._module.registry(this.compileNative)}checkModuleStatus(e){void 0!==this._moduleModel&&this._moduleModel.isHapModule()===this.isHap||this._log._buildError("The 'hvigorfile.js' import is not match the moduleType declared in module.json5/config.json. This may occur when the build-profile.json5 is copied from modules, or the module's hvigorfile.js requires different type of tasks, e.g. require hapTasks for a har module.")._solution("Check the correctness of build-profile.json5 or hvigorfile.js.")._file(this._module.getBuildFilePath())._printErrorAndExit(this._moduleModel?this._moduleModel.getName():"project"),this._moduleModel.getApiType()!==e&&this._log._buildError("The 'hvigorfile.js' import is not match the apiType!")._solution(`Change the apiType to '${e}'.`)._file(this._moduleModel.getProfilePath())._printErrorAndExit(this._moduleModel.getName())}getTaskService(){return this._taskService}}exports.AbstractModulePlugin=AbstractModulePlugin;