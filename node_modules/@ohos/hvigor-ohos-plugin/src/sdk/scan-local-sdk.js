"use strict";var __importDefault=this&&this.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.scanHosLocalSdkInst=exports.scanLocalSdkInst=void 0;const sdkmanager_common_1=require("@ohos/sdkmanager-common"),ohos_logger_1=require("../utils/log/ohos-logger"),pretty_hrtime_1=__importDefault(require("pretty-hrtime")),hos_sdkmanager_common_1=require("@ohos/hos-sdkmanager-common"),hvigor_base_1=require("@ohos/hvigor-base"),log=ohos_logger_1.OhosLogger.getLogger("OhosPlugin_ScanLocalSdk");class ScanLocalSdk{setSdKBaseDir(o){return this._sdkBaseDir!==o&&(this._localSdkComponents=void 0,this._sdkBaseDir=o),this}getLocalSdkComponents(){return void 0!==this._localSdkComponents?this._localSdkComponents:void 0!==this._sdkBaseDir?(this.setSdkInfoHandler(this.getSdkInfoHandler()),this._localSdkComponents):void 0}getSdkInfoHandler(){return new sdkmanager_common_1.OhSdkInfoHandler(sdkmanager_common_1.SdkInfoConfig.create(this._sdkBaseDir))}setSdkInfoHandler(o){log.debug("Sdk init...");const e=process.hrtime();try{this._localSdkComponents=o.getLocalSdks()}catch(o){if(o instanceof sdkmanager_common_1.SdkException){const e=o.getErrorTip();log._buildError(e.getReason())._solution(`${e.getFixSuggestion()}.Open SDK Manager`)._file(this._sdkBaseDir)._printErrorAndExit()}}finally{const o=process.hrtime(e),s=(0,pretty_hrtime_1.default)(o);log.debug(`Sdk handle finished...${s}`),recordTraceData(1e9*o[0]+o[1])}}}function recordTraceData(o){hvigor_base_1.traceBuildAnalyze.taskTime.set("sdkDirInit",o)}class ScanHosLocalSdk extends ScanLocalSdk{getSdkInfoHandler(){return new hos_sdkmanager_common_1.HosSdkInfoHandler(sdkmanager_common_1.SdkInfoConfig.create(this._sdkBaseDir))}}exports.scanLocalSdkInst=new ScanLocalSdk,exports.scanHosLocalSdkInst=new ScanHosLocalSdk;