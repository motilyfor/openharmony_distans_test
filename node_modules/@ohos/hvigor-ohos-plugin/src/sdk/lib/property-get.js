"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Property=void 0;const path_1=__importDefault(require("path")),fs_extra_1=__importDefault(require("fs-extra")),common_const_js_1=require("../../const/common-const.js"),property_const_js_1=require("../../const/property-const.js"),ohos_logger_js_1=require("../../utils/log/ohos-logger.js"),localPropertiesPath=path_1.default.resolve(process.cwd(),common_const_js_1.CommonConst.LOCAL_PROPERTIES);class Property{constructor(){this._log=ohos_logger_js_1.OhosLogger.getLogger(Property.name),this._properties=new Map,Property._readFile().split(/\r?\n/).forEach(this._setProperty,this),this._readPath()}static getInstance(){return this.instance||(this.instance=new Property),this.instance}static _readFile(){return fs_extra_1.default.existsSync(localPropertiesPath)?fs_extra_1.default.readFileSync(localPropertiesPath,{encoding:"utf-8"}):""}static normalizePathSeparator(t){return t.replace(/\\\\/g,"/").replace(/\\/g,"/").replace(/\/:/g,":")}getProperty(t){if(this._properties.has(t)){const r=this._properties.get(t);return r||""}return""}getNodeJsDir(){return this.validatePath(property_const_js_1.PropertyConst.NODE_JS_DIR,"NODE_HOME"),this.getProperty(property_const_js_1.PropertyConst.NODE_JS_DIR)}getSdkDir(){return this.validatePath(property_const_js_1.PropertyConst.SDK_DIR,"OHOS_SDK_HOME"),this.getProperty(property_const_js_1.PropertyConst.SDK_DIR)}getHosSdkDir(){return this.validatePath(property_const_js_1.PropertyConst.HWSDK_DIR,"HWSDK"),this.getProperty(property_const_js_1.PropertyConst.HWSDK_DIR)}validatePath(t,r){this._properties.has(t)||this._log._buildError(`Can not find '${t}' in 'local.properties' or '${r}' in System Environment Path.`)._file(localPropertiesPath)._printErrorAndExit();const e=this._properties.get(t);fs_extra_1.default.existsSync(e)||this._log._buildError(`'${t}' configured in 'local.properties' or '${r}' in System Environment Path is invalid, Please check.`)._file(e)._printErrorAndExit()}_readPath(){this._setPathIfNotExist(property_const_js_1.PropertyConst.SDK_DIR,process.env.OHOS_SDK_HOME),this._setPathIfNotExist(property_const_js_1.PropertyConst.NODE_JS_DIR,process.env.NODE_HOME),this._setPathIfNotExist(property_const_js_1.PropertyConst.NPM_DIR,process.env.NODE_HOME),this._setPathIfNotExist(property_const_js_1.PropertyConst.HWSDK_DIR,process.env.HWSDK)}_setPathIfNotExist(t,r){!this._properties.has(t)&&r&&this._properties.set(t,Property.normalizePathSeparator(r))}_setProperty(t){const r=t.trim();if(!r)return;const e=/^([^#=]+)(={0,1})(.*)$/.exec(r);e&&this._properties.set(e[1].trim(),Property.normalizePathSeparator(e[3].trim()))}}exports.Property=Property;