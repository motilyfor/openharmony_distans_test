"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SignHap=void 0;const path_1=__importDefault(require("path")),ohos_hap_task_js_1=require("./task/ohos-hap-task.js"),sign_util_js_1=require("./sign/sign-util.js"),legacy_package_hap_1=require("./legacy-tasks/legacy-package-hap"),task_names_js_1=require("./common/task-names.js"),package_hap_js_1=require("./package-hap.js"),sign_type_enum_js_1=require("../enum/sign-type-enum.js"),runtime_type_enum_js_1=require("../enum/runtime-type-enum.js");class SignHap extends ohos_hap_task_js_1.OhosHapTask{constructor(e){super(e,task_names_js_1.TaskNames.CommonTask.SIGN_HAP)}doTaskAction(e){const s=e.getPathInfo(),t=this.service.getRelatedEntryModules();if(t.length)for(const a of t)this.sign(s,a,e);else this.sign(s,"",e)}initTaskDepends(){this.module.registryDependsOnTask(this,this.isFaMode?new legacy_package_hap_1.LegacyPackageHap(this.service):new package_hap_js_1.PackageHap(this.service))}sign(e,s,t){const a=t.getModuleTargetOutputFileName(s,!1),i=path_1.default.resolve(e.getModuleBuildOutputPath(),a),_=path_1.default.resolve(e.getModuleBuildOutputPath(),t.getModuleTargetOutputFileName(s,!0)),n=t.getTargetStatus().is(runtime_type_enum_js_1.RuntimeTypeEnum.HARMONY_OS)?sign_type_enum_js_1.SignTypeEnum.HOS_HAP:sign_type_enum_js_1.SignTypeEnum.HAP;new sign_util_js_1.SignUtil(this.service,n,t.getProduct()).sign(i,_)}}exports.SignHap=SignHap;