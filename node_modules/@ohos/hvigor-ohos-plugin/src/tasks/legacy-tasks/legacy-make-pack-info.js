"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LegacyMakePackInfo=void 0;const ohos_logger_js_1=require("../../utils/log/ohos-logger.js"),task_names_js_1=require("../common/task-names.js"),legacy_merge_profile_js_1=require("./legacy-merge-profile.js");var LegacyFATask=task_names_js_1.TaskNames.LegacyFATask;const abstract_make_pack_info_js_1=require("../abstract-make-pack-info.js");class LegacyMakePackInfo extends abstract_make_pack_info_js_1.AbstractMakePackInfo{constructor(e){super(e,LegacyFATask.MAKE_PACK_INFO),this._log=ohos_logger_js_1.OhosLogger.getLogger(LegacyMakePackInfo.name)}initTaskDepends(){this.module.registryDependsOnTask(this,new legacy_merge_profile_js_1.LegacyMergeProfile(this.service))}doTaskAction(e){const s=this.service.getModuleModel().getJsonObjByTargetName(e.getTargetName()),o={bundleName:s.app.bundleName,version:s.app.version},a=this.getModuleObj(s),t=this.service.getRelatedEntryModules();if(t.length){const i=this.service.getProjectModel();for(const r of t)if(i.getModuleModelByName(r)){const t=i.getModuleModelByName(r).getJsonObjByTargetName(e.getTargetName()),l=this.getModuleObj(t);this.buildPackInfo(this._log,r,e,s,o,a,t,l)}}else this.buildPackInfo(this._log,"",e,s,o,a,void 0,void 0)}getModuleObj(e){return{mainAbility:e.module.mainAbility,deviceType:e.module.deviceType,abilities:this.processAbilities(e.module.abilities),distro:e.module.distro,apiVersion:e.app.apiVersion}}getPackageObj(e,s,o){return{deviceType:o?o.module.deviceType:e.module.deviceType,moduleType:e.module.distro.moduleType,deliveryWithInstall:e.module.distro.deliveryWithInstall,name:s}}}exports.LegacyMakePackInfo=LegacyMakePackInfo;