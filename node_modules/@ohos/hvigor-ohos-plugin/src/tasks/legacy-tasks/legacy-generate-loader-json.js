"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,o)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.LegacyGenerateLoaderJson=void 0;const path_1=__importDefault(require("path")),fse=__importStar(require("fs-extra")),generate_loader_json_js_1=require("../generate-loader-json.js"),ability_type_enum_js_1=require("../../enum/ability-type-enum.js"),build_directory_const_js_1=require("../../const/build-directory-const.js"),pre_build_js_1=require("../pre-build.js");class LegacyGenerateLoaderJson extends generate_loader_json_js_1.GenerateLoaderJson{constructor(e){super(e)}initTaskDepends(){this.module.registryDependsOnTask(this,new pre_build_js_1.PreBuild(this.service))}doTaskAction(e){const t=this.service.getModuleModel().getLegacyAbilities(e.getTargetName());for(let r=0;r<t.length;r++){const i=t[r];i.getType()!==ability_type_enum_js_1.AbilityTypeEnum.PAGE&&i.getType()!==ability_type_enum_js_1.AbilityTypeEnum.FORM||this.generateJsonInfo(e,t[r])}}beforeTask(e){const t=e.getPathInfo().getIntermediatesLoaderPath();fse.removeSync(t)}getMultiResourceBuild(e,t){var r;const i=null===(r=e.getTargetOpt().source)||void 0===r?void 0:r.abilities;if(void 0!==i)for(let e=0;e<i.length;e++)if(i[e].name===t.getName())return{pages:i[e].pages,res:i[e].res}}generateJsonInfo(e,t){const r=path_1.default.resolve(e.getPathInfo().getIntermediatesLoaderPath(),t.getRelateSrcPath(),build_directory_const_js_1.BuildArtifactConst.LOADER_JSON);fse.outputJSONSync(r,{workers:this.getWorkerConfig(),multiResourceBuild:this.getMultiResourceBuild(e,t)})}}exports.LegacyGenerateLoaderJson=LegacyGenerateLoaderJson;