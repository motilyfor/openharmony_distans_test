"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.OhosModuleModelBean=void 0;const map_util_js_1=require("../../../utils/map-util.js"),build_directory_const_js_1=require("../../../const/build-directory-const.js"),path_1=__importDefault(require("path")),common_const_js_1=require("../../../const/common-const.js"),default_plugin_id_1=require("../../../plugin/common/default-plugin-id"),task_names_js_1=require("../../common/task-names.js"),compile_node_js_1=require("../../compile-node.js"),code_type_enum_js_1=require("../../../enum/code-type-enum.js");class OhosModuleModelBean{constructor(e){this.modelId="ohos-module",this._module=e,this.modelId=this.modelId.concat("-").concat(e.getName());const t=e.getPluginById(default_plugin_id_1.DefaultPluginId.OHOS_HAP_PLUGIN);this._moduleTaskService=t.getTaskService(),this._targetDataSet=this._moduleTaskService.getTargetDataSet()}computeCommonInfo(e){e.set("SELECT_TARGET",common_const_js_1.DefaultTargetConst.DEFAULT_TARGET),e.set("MODULE_BUILD_DIR",path_1.default.resolve(this._module.getNodeDir(),build_directory_const_js_1.BuildDirConst.BUILD_ROOT))}computePathInfo(e){const t=new Map;this._targetDataSet.forEach((e=>{const o=new Map,s=e[0].getPathInfo(),a=this._moduleTaskService.getModuleModel(),_=this._moduleTaskService.getHapExtraInfo().isStageMode()?task_names_js_1.TaskNames.Task.COMPILE_NODE.name:task_names_js_1.TaskNames.LegacyFATask.COMPILE_NODE.name,i=path_1.default.resolve(s.getModuleBuildCachePath(),compile_node_js_1.CompileNode.getCompileNodeTaskName(code_type_enum_js_1.CodeType.ETS,_)),d=path_1.default.resolve(s.getModuleBuildCachePath(),compile_node_js_1.CompileNode.getCompileNodeTaskName(code_type_enum_js_1.CodeType.JS,_)),l=path_1.default.resolve(s.getIntermediatesLoaderPath(),build_directory_const_js_1.BuildArtifactConst.LOADER_JSON),u={OUTPUT_PATH:s.getModuleBuildOutputPath(),JS_ASSETS_PATH:s.getIntermediatesAssetsPath(),RES_PATH:path_1.default.resolve(s.getIntermediatesRes(),this.getFirstEntryName()),RES_PROFILE_PATH:s.getIntermediatesResProfilePath(),ETS_SUPER_VISUAL_PATH:i,JS_SUPER_VISUAL_PATH:d,WORKER_LOADER:l,MANIFEST_JSON:s.getIntermediatesLegacyManifestJson()};o.set("SOURCE_ROOT",null==a?void 0:a.getSourceRootByTargetName(e[0].getTargetName()));const r=[];r.push(null==a?void 0:a.getSourceSetByTargetName(e[0].getTargetName()).getTargetResPath()),o.set("RESOURCES_PATH",r),o.set("BUILD_PATH",u),t.set(e[0].getTargetName(),o)})),e.set("TARGETS",t)}getFirstEntryName(){const e=this._moduleTaskService.getRelatedEntryModules();return 0!==e.length?e[0]:""}buildModel(){const e=new Map;return this.computeCommonInfo(e),this.computePathInfo(e),(0,map_util_js_1.strMapToObj)(e)}}exports.OhosModuleModelBean=OhosModuleModelBean;