"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o);var s=Object.getOwnPropertyDescriptor(t,o);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,r,s)}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&__createBinding(t,e,o);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ReplacePreviewerPage=void 0;const hvigor_base_1=require("@ohos/hvigor-base"),ohos_hap_task_1=require("../task/ohos-hap-task"),path_1=__importDefault(require("path")),common_const_1=require("../../const/common-const"),fse=__importStar(require("fs-extra")),inject_const_1=require("../../const/inject-const"),project_file_reader_js_1=require("../../utils/project-file-reader.js"),ohos_logger_js_1=require("../../utils/log/ohos-logger.js"),task_names_js_1=require("../common/task-names.js");var CommonTask=task_names_js_1.TaskNames.CommonTask;class ReplacePreviewerPage extends ohos_hap_task_1.OhosHapTask{constructor(e){super(e,CommonTask.REPLACE_PREVIEWER_PAGES),this._log=ohos_logger_js_1.OhosLogger.getLogger(ReplacePreviewerPage.name)}initTaskDepends(){}doTaskAction(e){const t=hvigor_base_1.hvigor.getExtraConfig().get(inject_const_1.InjectConst.PREVIEWER_REPLACE_PAGE);if(!t)return;const o=e.getPathInfo(),r=path_1.default.resolve(o.getIntermediatesRes(),common_const_1.CommonConst.MODULE_JSON),s=project_file_reader_js_1.ProjectFileReader.getJson5Obj(r).module.pages;if(!s)return void this._log._buildError("Unabled to replace. Cannot find moduleJsonObj.module.pages.")._printErrorAndExit(this.moduleModel.getName());const a={src:[t]},i=`${s.replace(/\$profile:/,"")}.json`,n=path_1.default.resolve(o.getIntermediatesResProfilePath(),i);this._log.debug(`Resolved file ${n}.`),this._log.debug(`Replace page to ${t}`),fse.outputJSONSync(n,a)}}exports.ReplacePreviewerPage=ReplacePreviewerPage;