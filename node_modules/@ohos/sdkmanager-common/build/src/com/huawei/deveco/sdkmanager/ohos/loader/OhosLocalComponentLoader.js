"use strict";var __importDefault=this&&this.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(exports,"__esModule",{value:!0});const AbstractLocalComponentLoader_1=require("../../core/loader/AbstractLocalComponentLoader"),Utils_1=require("../../core/util/Utils"),ComponentContants_1=require("../../core/constants/ComponentContants"),ComponentDto_1=require("../../core/loader/ComponentDto"),OhComponentConstants_1=require("../const/OhComponentConstants"),path_1=__importDefault(require("path"));class OhosLocalComponentLoader extends AbstractLocalComponentLoader_1.AbstractLocalComponentLoader{constructor(o,t){super(OhosLocalComponentLoader._MAX_SCAN_DEPTH,o,t),this._legacyComponents=new Array}configMeta(o,t){var n;const e=new ComponentDto_1.MetaDto;if(OhComponentConstants_1.IGNORE_SDK_VERSIONS.includes(t.getVersion()))return e.metaVersion=ComponentContants_1.VERSION_2_0_0,void(t.meta=e);const a=null===(n=o.meta)||void 0===n?void 0:n.metaVersion;(0,Utils_1.isEmpty)(a)?e.metaVersion=OhComponentConstants_1.SUPPORT_META_VERSION:e.metaVersion=a,t.meta=e}isComponentInRightPlace(o,t){return super.isComponentInRightPlace(o,t)?!(ComponentContants_1.ComponentPath.TOOLCHAINS===o.getPath()&&(OhComponentConstants_1.NEED_DELETE_TOOLCHAINS_VERSION.includes(o.getVersion())||!o.hasApiVersion()))||(this._legacyComponents.push(o),!1):(ComponentContants_1.ComponentPath.TOOLCHAINS===o.getPath()&&OhComponentConstants_1.MIGRATE_TOOLCHAINS_VERSION.includes(o.getVersion())&&(o.location=path_1.default.resolve(t,".."),this._legacyComponents.push(o)),!1)}getLocation(o,t){return ComponentContants_1.ComponentPath.TOOLCHAINS===o.getPath()&&OhComponentConstants_1.MIGRATE_TOOLCHAINS_VERSION.includes(o.getVersion())&&(o.apiVersion=OhComponentConstants_1.MIGRATE_TOOLCHAINS_API_VERSION),super.getLocation(o,t)}getUniPackageName(){return OhosLocalComponentLoader._UNI_PACKAGE_NAME}getLegacyComponents(){return this._legacyComponents}}exports.default=OhosLocalComponentLoader,OhosLocalComponentLoader._MAX_SCAN_DEPTH=5,OhosLocalComponentLoader._UNI_PACKAGE_NAME="oh-uni-package.json";